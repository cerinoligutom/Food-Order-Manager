<!-- ORDER ITEMS -->
<div class="container">
  <div class="row">
    <div class="col-md-12" style="padding: 5px 0px 5px 30px;">
      <mat-card class="col-md-12" style="display:flex;flex-direction:row;justify-content:space-between">
        <mat-card-header>
          <img mat-card-avatar [src]="transaction?.Vendor.image || defaultVendorImage" alt="{{ transaction?.Vendor.name }} image">
          <mat-card-title>{{ transaction?.Vendor.name }}</mat-card-title>
          <mat-card-subtitle>{{ formatDates(transaction?.created_at.raw).shortDate }} {{ formatDates(transaction?.created_at.raw).time }}</mat-card-subtitle>
        </mat-card-header>
        <button mat-raised-button color="warn" *ngIf="orderIndex == -1" (click)="openAddOrderDialog(transaction?.id, transaction?.Vendor.id)">Order NOW!</button>
        <button mat-raised-button color="warn" *ngIf="orderIndex != -1" (click)="openUpdateOrderDialog(transaction?.id, transaction?.Vendor.id, transactionOrders[orderIndex])">Add More NOW!</button>
      </mat-card>
    </div>
  </div>
  <div class="row order-row">
    <div class="col-md-8 order-items-panel card-columns">
      <div class="col-md-6 card" *ngFor="let order of transactionOrders">
        <mat-card>
          <mat-card-header>
            <img mat-card-avatar [src]="order.User.image || defaultUserImage" alt="{{ order.User.name }} image">
            <mat-card-title>{{ order.User.full_name }}</mat-card-title>
            <mat-card-subtitle>{{ formatDates(order.created_at.raw).shortDate }} {{ formatDates(order.created_at.raw).time }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <mat-list>
              <mat-list-item *ngFor="let orderItem of order.OrderItems" class="order-item-container">
                <div class="column">
                  <div class="order-item">
                    <div class="img-container">
                      <img [src]="orderItem.Product.image || defaultProductImage" alt="{{ orderItem.Product.name }} image" class="product-image">
                    </div>
                    <div class="order-item-details">
                      <span>{{ orderItem.Product.name }}</span>
                      <span>₱ {{ orderItem.Product.price | number: '.2' }} x {{ orderItem.quantity }}{{ (orderItem.quantity > 1)
                        ? 'pcs': 'pc' }}</span>
                    </div>
                  </div>
                  <div class="order-item-comments" *ngIf="orderItem.comment">
                    <span class="comment-text">Comment:</span>{{ orderItem.comment }}
                  </div>
                </div>
                <div class="order-item-actions" *ngIf="currentLoggedInUser.id === order.User.id">
                  <button mat-icon-button class="edit" (click)="showEditOrderItemDialog(orderItem.id)">
                    <mat-icon>mode_edit</mat-icon>
                  </button>
                  <button mat-icon-button class="cancel" (click)="cancelOrderItem(orderItem.id, order)">
                    <mat-icon>close</mat-icon>
                  </button>
                </div>
              </mat-list-item>
            </mat-list>
            <div class="total-sum-container">
              <h2>₱ {{ calculateTotalSum(order.OrderItems) | number:'.2'}}</h2>
            </div>
          </mat-card-content>
          <mat-card-actions class="button-actions-container">
            <button mat-raised-button class="cancel" *ngIf="currentLoggedInUser.id === order.User.id" (click)="cancelOrder(order.id)">Cancel</button>
            <button mat-raised-button [ngClass]="{ 'fully-paid': order.isFullyPaid, 'not-fully-paid': !order.isFullyPaid }" *ngIf="currentLoggedInUser.id === transaction?.Host.id" (click)="isFullyPaid(order.id, order.isFullyPaid)">
              <mat-icon style="vertical-align: middle;" *ngIf="order.isFullyPaid">check_circle</mat-icon>
              <mat-icon style="vertical-align: middle;" *ngIf="!order.isFullyPaid">cancel</mat-icon>
              Fully Paid
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>

    <!-- TRANSACTION SUMMARY -->
    <div class="col-md-4 transaction-host-panel">
      <mat-card class="col-md-12">
        <mat-card-header>
          <img mat-card-avatar [src]="transaction?.Host.image || defaultUserImage" alt="{{ transaction?.Host.name }} image">
          <mat-card-title>{{ transaction?.Host.full_name }}</mat-card-title>
          <mat-card-subtitle>Host</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <mat-list>
            <mat-list-item *ngFor="let product of transactionSummary.products" class="order-item-container">
              <div class="column">
                <div class="order-item">
                  <div class="img-container">
                    <img [src]="product.image || defaultProductImage" alt="{{ product.name }} image" class="product-image">
                  </div>
                  <div class="order-item-details">
                    <span>
                      <strong>{{ product.name }}</strong>
                    </span>
                    <span>₱ {{ product.price | number: '.2' }} x
                      <strong>{{ product.quantity }}{{ (product.quantity > 1) ? 'pcs': 'pc' }}
                      </strong>
                    </span>
                  </div>
                </div>
                <div class="order-item-comments" *ngIf="product.comments.length > 0">
                  <span class="comment-text">Comments:</span>
                  <ul class="comment-list">
                    <li *ngFor="let comment of product.comments">
                      {{ comment }}
                    </li>
                  </ul>
                </div>
              </div>
              <mat-divider></mat-divider>
            </mat-list-item>
            <div class="total-sum-container">
              <h2>₱ {{ transactionSummary.sum | number:'.2'}}</h2>
            </div>
          </mat-list>
        </mat-card-content>
        <mat-card-actions class="transaction-button-actions-container">
          <button mat-raised-button [ngClass]="{ 'fulfilled': transaction.is_fulfilled, 'not-fulfilled': !transaction.is_fulfilled }" color="primary" *ngIf="currentLoggedInUser.id === transaction?.Host.id" (click)="changeTransactionStatus(transaction.id, transaction.is_fulfilled)">
            <mat-icon style="vertical-align: middle;" *ngIf="transaction.is_fulfilled">check_circle</mat-icon>
            <mat-icon style="vertical-align: middle;" *ngIf="!transaction.is_fulfilled">cancel</mat-icon>
            Fulfilled
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>
